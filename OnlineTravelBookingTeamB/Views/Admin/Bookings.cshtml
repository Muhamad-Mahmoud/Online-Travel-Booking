@model OnlineTravelBookingTeamB.Models.AdminBookingsViewModel

@{
    ViewData["Title"] = "Bookings";
}

<form method="get" action="/Admin/Bookings" class="row g-3 justify-content-between align-items-center mb-4">
    <div class="col-12 col-lg-auto">
        <h1 class="h3 fw-bold text-dark mb-1">Bookings</h1>
        <p class="text-muted small mb-0">Manage and track all customer reservations in one place.</p>
    </div>
    <div class="col-12 col-lg-auto">
        <div class="d-flex flex-column flex-sm-row flex-lg-nowrap gap-2 filter-section">
            <div class="input-group shadow-sm search-group">
                <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                <input type="text" name="searchTerm" class="form-control border-start-0 ps-0" placeholder="Search reference, user, service..." value="@ViewBag.SearchTerm">
            </div>
            <select name="status" class="form-select shadow-sm status-select" onchange="this.form.submit()">
                <option value="">All Status</option>
                @if (ViewBag.BookingStatuses != null) {
                    foreach (var status in ViewBag.BookingStatuses)
                    {
                        <!option value="@status" @(ViewBag.Status == status ? "selected" : "")>@status</!option>
                    }
                }
            </select>
            <div class="d-flex gap-2 action-buttons">
                <button type="submit" class="btn btn-primary shadow-sm"><i class="fas fa-filter me-2"></i>Filter</button>
                <a asp-controller="Admin" asp-action="Bookings" class="btn btn-white shadow-sm" title="Clear Filters"><i class="fas fa-undo text-muted"></i></a>
            </div>
        </div>
    </div>
</form>

<!-- Stats Overview -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="stat-card h-100 border-start border-4 border-primary">
            <div class="stat-header mb-2">
                <span class="text-uppercase text-muted small fw-bold">Total Bookings</span>
                <i class="fas fa-calendar-check text-primary opacity-50 fa-lg"></i>
            </div>
            <div class="h3 fw-bold mb-0">@Model.Stats.TotalBookings</div>
            <span class="small text-success"><i class="fas fa-arrow-up me-1"></i>12% increase</span>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card h-100 border-start border-4 border-warning">
            <div class="stat-header mb-2">
                <span class="text-uppercase text-muted small fw-bold">Pending</span>
                <i class="fas fa-clock text-warning opacity-50 fa-lg"></i>
            </div>
            <div class="h3 fw-bold mb-0">@Model.Stats.PendingBookings</div>
            <span class="small text-muted">Awaiting confirmation</span>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card h-100 border-start border-4 border-success">
            <div class="stat-header mb-2">
                <span class="text-uppercase text-muted small fw-bold">Revenue</span>
                <i class="fas fa-dollar-sign text-success opacity-50 fa-lg"></i>
            </div>
            <div class="h3 fw-bold mb-0">@Model.Stats.TotalRevenue.ToString("N0") $</div>
            <span class="small text-success">Confirmed bookings</span>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card h-100 border-start border-4 border-danger">
            <div class="stat-header mb-2">
                <span class="text-uppercase text-muted small fw-bold">Cancelled</span>
                <i class="fas fa-ban text-danger opacity-50 fa-lg"></i>
            </div>
            <div class="h3 fw-bold mb-0">@Model.Stats.CancelledBookings</div>
            <span class="small text-danger">Lost / Expired</span>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0 rounded-4 overflow-hidden">
    <div class="card-header bg-white py-3 border-bottom d-flex justify-content-between align-items-center">
        <h6 class="m-0 fw-bold text-dark">Recent Reservations</h6>
    </div>
    <partial name="_BookingList" model="Model.Bookings.Data" />

    <div class="card-footer bg-white py-3 border-top-0 d-flex justify-content-between align-items-center">
        <span class="text-muted small">Showing @Model.Bookings.Data.Count entries of @Model.Bookings.TotalCount</span>
        <nav>
            <ul class="pagination pagination-sm mb-0 align-items-center">
                <li class="page-item @(!Model.Bookings.HasPreviousPage ? "disabled" : "")">
                    <a class="page-link" href="@Url.Action("Bookings", new { pageIndex = Model.Bookings.PageIndex - 1, searchTerm = ViewBag.SearchTerm, status = ViewBag.Status })"><i class="fas fa-chevron-left"></i></a>
                </li>
                
                @for (int i = 1; i <= Model.Bookings.TotalPages; i++)
                {
                     <li class="page-item @(i == Model.Bookings.PageIndex ? "active" : "")">
                        <a class="page-link" href="@Url.Action("Bookings", new { pageIndex = i, searchTerm = ViewBag.SearchTerm, status = ViewBag.Status })">@i</a>
                    </li>
                }

                <li class="page-item @(!Model.Bookings.HasNextPage ? "disabled" : "")">
                    <a class="page-link" href="@Url.Action("Bookings", new { pageIndex = Model.Bookings.PageIndex + 1, searchTerm = ViewBag.SearchTerm, status = ViewBag.Status })"><i class="fas fa-chevron-right"></i></a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<style>
    .stat-card {
        background: #fff;
        padding: 1.25rem;
        border-radius: 0.75rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        transition: transform 0.2s;
    }
    .stat-card:hover { transform: translateY(-3px); }
    .stat-header { display: flex; justify-content: space-between; align-items: center; }
    .btn-white {
        background-color: #fff;
        border: 1px solid #e3e6f0;
        color: #6e707e;
    }
    .btn-white:hover {
        background-color: #f8f9fc;
    }
    
    /* Search Group Styling */
    .search-group {
        border-radius: 0.375rem;
        transition: box-shadow 0.2s;
    }
    .search-group:focus-within {
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
        border-color: #86b7fe;
    }
    .search-group .input-group-text {
        border-color: #dee2e6; /* Match default bootstrap border */
    }
    .search-group .form-control {
        border-color: #dee2e6;
    }
    
    /* Remove default focus from input to prevent double border look */
    .search-group .form-control:focus {
        box-shadow: none;
        border-color: #dee2e6;
    }
    
    /* Ensure borders match when focused via parent */
    .search-group:focus-within .input-group-text,
    .search-group:focus-within .form-control {
        border-color: #86b7fe;
        z-index: 2;
    }
</style>
