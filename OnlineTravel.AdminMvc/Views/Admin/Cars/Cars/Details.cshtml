@using OnlineTravel.Application.Features.Cars.GetCarByIdWithDetails
@model CarDetailsDto

@{
    ViewData["Title"] = $"{Model.Make} {Model.Model} Details";
}

<div class="page-title d-flex justify-content-between align-items-center">
    <span><i class="fas fa-info-circle me-2 text-primary"></i> Vehicle Specifications</span>
    <div>
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning shadow-sm rounded-pill px-4 me-2">
            <i class="fas fa-edit me-2"></i> Edit Vehicle
        </a>
        <a asp-action="Index" class="btn btn-light shadow-sm rounded-pill px-4">
            <i class="fas fa-arrow-left me-2"></i> Back to Fleet
        </a>
    </div>
</div>

<div class="row g-4">
    <!-- Left Column: Media & Overview -->
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
            <div id="carGallery" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    @for (int i = 0; i < Model.Images.Count; i++)
                    {
                        <div class="carousel-item @(i == 0 ? "active" : "")">
                            <img src="@Model.Images[i].Url" class="d-block w-100" alt="@Model.Images[i].AltText" style="height: 450px; object-fit: cover;">
                            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded-pill px-3 py-1 mb-3 mx-auto" style="width: fit-content;">
                                <p class="mb-0 small">@Model.Images[i].AltText</p>
                            </div>
                        </div>
                    }
                    @if (!Model.Images.Any())
                    {
                        <div class="carousel-item active">
                            <div class="d-flex align-items-center justify-content-center bg-light" style="height: 450px;">
                                <i class="fas fa-image fa-4x text-muted opacity-25"></i>
                            </div>
                        </div>
                    }
                </div>
                @if (Model.Images.Count > 1)
                {
                    <button class="carousel-control-prev" type="button" data-bs-target="#carGallery" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carGallery" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    </button>
                }
            </div>
            <div class="card-body p-4 bg-white border-top">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h2 class="fw-bold text-dark mb-0">@Model.Make @Model.Model</h2>
                        <span class="badge bg-soft-primary px-3 py-2 mt-2">@Model.CarType</span>
                    </div>
                    <div class="text-end">
                        <div class="small text-muted mb-1 text-uppercase fw-bold">Brand</div>
                        <h5 class="fw-bold">@Model.BrandName</h5>
                    </div>
                </div>
                <hr class="opacity-10">
                <div class="row g-3 mt-2">
                    <div class="col-md-3 text-center border-end">
                        <i class="fas fa-users text-primary mb-2"></i>
                        <div class="small text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Seats</div>
                        <div class="fw-bold">@Model.SeatsCount People</div>
                    </div>
                    <div class="col-md-3 text-center border-end">
                        <i class="fas fa-gas-pump text-primary mb-2"></i>
                        <div class="small text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Fuel</div>
                        <div class="fw-bold">@Model.FuelType</div>
                    </div>
                    <div class="col-md-3 text-center border-end">
                        <i class="fas fa-cog text-primary mb-2"></i>
                        <div class="small text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Transmission</div>
                        <div class="fw-bold">@Model.Transmission</div>
                    </div>
                    <div class="col-md-3 text-center">
                        <i class="fas fa-calendar-alt text-primary mb-2"></i>
                        <div class="small text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Category</div>
                        <div class="fw-bold">@Model.CategoryTitle</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm rounded-4 mb-4">
            <div class="card-body p-4">
                <h5 class="fw-bold mb-4 border-start border-4 border-primary ps-3">Features & Accessories</h5>
                <div class="d-flex flex-wrap gap-2">
                    @foreach (var feature in Model.Features)
                    {
                        <span class="badge bg-light text-dark fw-normal border px-3 py-2 rounded-pill">
                            <i class="fas fa-check text-success me-2"></i> @feature
                        </span>
                    }
                </div>
                
                <h5 class="fw-bold mt-5 mb-4 border-start border-4 border-primary ps-3">Cancellation Policy</h5>
                <div class="bg-light p-4 rounded-4 text-muted">
                    @Model.CancellationPolicy
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Sidebar Info -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 mb-4">
            <div class="card-header bg-transparent border-bottom py-3">
                <h5 class="card-title mb-0 fw-bold">Pricing Structure</h5>
            </div>
            <div class="card-body p-4">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light small">
                            <tr>
                                <th class="py-2">Duration (Hrs)</th>
                                <th class="py-2 text-end">Rate/Hr</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var tier in Model.PricingTiers)
                            {
                                <tr>
                                    <td class="py-3">@tier.FromHours - @tier.ToHours</td>
                                    <td class="py-3 text-end fw-bold text-primary">@tier.PricePerHour.Amount.ToString("C") @tier.PricePerHour.Currency</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="mt-4">
                    <a asp-controller="CarPricingTiers" asp-action="Index" asp-route-carId="@Model.Id" class="btn btn-soft-primary w-100 rounded-pill fw-bold py-3">
                        <i class="fas fa-tags me-2"></i> Manage Pricing Tiers
                    </a>
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm rounded-4 mb-4">
            <div class="card-header bg-transparent border-bottom py-3">
                <h5 class="card-title mb-0 fw-bold">Availability Schedule</h5>
            </div>
            <div class="card-body p-4">
                <div class="list-group list-group-flush">
                    @foreach (var date in Model.AvailableDates)
                    {
                        <div class="list-group-item px-0 py-3 bg-transparent">
                            <div class="d-flex align-items-center">
                                <i class="far fa-calendar-check text-success me-3 fa-lg"></i>
                                <div>
                                    <div class="fw-bold small">@date.Start.ToString("MMM dd, yyyy HH:mm")</div>
                                    <div class="small text-muted">Until @date.End.ToString("MMM dd, yyyy HH:mm")</div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm rounded-4 mb-4 bg-primary text-white">
            <div class="card-body p-4">
                <h5 class="fw-bold mb-3"><i class="fas fa-map-marker-alt me-2"></i> Pickup Location</h5>
                <div class="p-3 bg-white bg-opacity-25 rounded-4 mb-3">
                    <div class="small fw-bold mb-1 opacity-75">COORDINATES</div>
                    <div class="fw-bold">@Model.Location.Latitude, @Model.Location.Longitude</div>
                </div>
                <button class="btn btn-outline-light w-100 rounded-pill py-2" onclick="window.open('https://www.google.com/maps/search/?api=1&query=@Model.Location.Latitude,@Model.Location.Longitude', '_blank')">
                    <i class="fas fa-external-link-alt me-2"></i> View on Maps
                </button>
            </div>
        </div>

        <div class="text-center mt-3">
            <p class="text-muted small">
                Last updated: @(Model.UpdatedAt?.ToString("MMM dd, yyyy HH:mm") ?? "N/A")<br>
                Created: @Model.CreatedAt.ToString("MMM dd, yyyy HH:mm")
            </p>
        </div>
    </div>
</div>
